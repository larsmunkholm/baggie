{"version":3,"file":"TextareaWithHighlights-7d178d92.js","sources":["../../packages/react/lib/hooks/useForwardedRef/useForwardedRef.js","../../packages/react/lib/inputs/TextareaWithHighlights/hooks/useValueWithHighlights.js","../../packages/react/lib/inputs/TextareaWithHighlights/TextareaWithHighlights.module.scss.js","../../packages/react/lib/inputs/TextareaWithHighlights/TextareaWithHighlights.js"],"sourcesContent":["import { useRef, useEffect } from 'react';\n\nconst useForwardedRef = (forwardedRef, initialValue = null) => {\n  const innerRef = useRef(initialValue);\n  useEffect(() => {\n    if (!forwardedRef) {\n      return;\n    }\n    if (typeof forwardedRef === \"function\") {\n      forwardedRef(innerRef.current);\n      return;\n    } else {\n      forwardedRef.current = innerRef.current;\n    }\n  });\n  return innerRef;\n};\n\nexport { useForwardedRef };\n","import React, { useMemo } from 'react';\n\nconst useValueWithHighlights = (value, highlights) => useMemo(() => {\n  if (!highlights)\n    return [];\n  const { ranges, regexes, strings } = (Array.isArray(highlights) ? typeof highlights[0] === \"number\" ? [highlights] : highlights : [highlights]).reduce(\n    (acc, cur) => {\n      if (typeof cur === \"string\") {\n        acc.strings.push(cur);\n      } else if (Array.isArray(cur) && typeof cur[0] === \"number\" && typeof cur[1] === \"number\") {\n        acc.ranges.push(cur);\n      } else if (cur instanceof RegExp) {\n        acc.regexes.push(cur);\n      }\n      return acc;\n    },\n    { ranges: [], regexes: [], strings: [] }\n  );\n  if (!ranges.length && !regexes.length && !strings.length)\n    return [];\n  const stringsAsRanges = [];\n  for (let string = 0; string < strings.length; string++) {\n    let i = -1;\n    while ((i = value.indexOf(strings[string], i + 1)) >= 0) {\n      stringsAsRanges.push([i, i + strings[string].length]);\n    }\n  }\n  const regexesAsRanges = [];\n  for (let regex = 0; regex < regexes.length; regex++) {\n    const matches = [];\n    if (regexes[regex].global) {\n      let prevIndex = -1;\n      let match;\n      while ((match = regexes[regex].exec(value)) !== null && (!matches.length || match.index > matches[prevIndex][0])) {\n        matches.push([match.index, match.index + match[0].length]);\n        prevIndex++;\n      }\n    } else {\n      const match = regexes[regex].exec(value);\n      if (match) {\n        matches.push([match.index, match.index + match[0].length]);\n      }\n    }\n    regexesAsRanges.push(...matches);\n  }\n  const allRanges = [...ranges, ...stringsAsRanges, ...regexesAsRanges];\n  if (!allRanges.length)\n    return [];\n  const sortedRanges = allRanges.sort((a, b) => a[0] - b[0]);\n  const mergedRanges = [sortedRanges[0]];\n  for (let i = 1; i < sortedRanges.length; i++) {\n    const [start, end] = sortedRanges[i];\n    const prev = mergedRanges[mergedRanges.length - 1];\n    if (prev[1] >= start) {\n      prev[1] = Math.max(prev[1], end);\n    } else {\n      mergedRanges.push(sortedRanges[i]);\n    }\n  }\n  return [\n    value.slice(0, mergedRanges[0][0]),\n    ...mergedRanges.map(([from, to], index) => /* @__PURE__ */ React.createElement(React.Fragment, { key: `${from}:${to}` }, /* @__PURE__ */ React.createElement(\"mark\", null, value.slice(from, to)), mergedRanges[index + 1] ? value.slice(to, mergedRanges[index + 1][0]) : void 0))\n  ];\n}, [value, highlights]);\n\nexport { useValueWithHighlights };\n","(function () {\n\t'use strict';\n\n\ttry{if(typeof document != 'undefined'){var elementStyle = document.createElement('style');elementStyle.appendChild(document.createTextNode(\"._highlightArea_4i7ca_1 {\\n  border-color: transparent !important;\\n  border-style: solid;\\n  border-width: 1px;\\n  box-sizing: border-box;\\n  color: transparent !important;\\n  display: inline-block;\\n  font-family: monospace;\\n  letter-spacing: normal;\\n  line-height: normal;\\n  overflow: hidden !important;\\n  overflow-wrap: break-word;\\n  padding: 2px;\\n  pointer-events: none !important;\\n  position: absolute !important;\\n  -webkit-rtl-ordering: logical;\\n  text-align: start;\\n  text-indent: 0;\\n  text-transform: none;\\n  white-space: pre-wrap;\\n  word-spacing: normal;\\n  writing-mode: horizontal-tb;\\n  z-index: 1 !important;\\n}\\n._highlightArea_4i7ca_1 mark {\\n  color: inherit !important;\\n  word-wrap: inherit !important;\\n}\"));document.head.appendChild(elementStyle);}}catch(e){console.error('vite-plugin-css-injected-by-js', e);}\n\n})();\nconst highlightArea = \"_highlightArea_4i7ca_1\";\nconst S = {\n\thighlightArea: highlightArea\n};\n\nexport { S as default, highlightArea };\n","import React, { forwardRef, useState, useRef, useCallback, useEffect } from 'react';\nimport { useForwardedRef } from '../../hooks/useForwardedRef/useForwardedRef.js';\nimport { useValueWithHighlights } from './hooks/useValueWithHighlights.js';\nimport S from './TextareaWithHighlights.module.scss.js';\n\nconst TextareaWithHighlights = forwardRef(({ highlights, onChange, onScroll, ...props }, ref) => {\n  const [value, setValue] = useState(\n    String(props.value || props.defaultValue || \"\")\n  );\n  const [style, setStyle] = useState();\n  const highlightAreaRef = useRef(null);\n  const textareaRef = useForwardedRef(ref);\n  const valueWithHighlights = useValueWithHighlights(value, highlights);\n  const handleChange = useCallback(\n    (event) => {\n      setValue(event.target.value);\n      if (onChange) {\n        onChange(event);\n      }\n    },\n    [onChange]\n  );\n  const handleScroll = useCallback(\n    (event) => {\n      if (highlightAreaRef?.current) {\n        const target = event.target;\n        highlightAreaRef.current.scrollLeft = target.scrollLeft;\n        highlightAreaRef.current.scrollTop = target.scrollTop;\n      }\n      if (onScroll) {\n        onScroll(event);\n      }\n    },\n    [onScroll]\n  );\n  const copySize = useCallback((entry) => {\n    if (highlightAreaRef?.current && entry) {\n      const width = entry.borderBoxSize[0].inlineSize;\n      const height = entry.borderBoxSize[0].blockSize;\n      highlightAreaRef.current.style.width = `${width}px`;\n      highlightAreaRef.current.style.height = `${height}px`;\n    }\n  }, []);\n  const copyStyle = useCallback(() => {\n    const computedStyle = window.getComputedStyle(\n      textareaRef.current\n    );\n    const filteredStyles = {\n      font: computedStyle.getPropertyValue(\"font\"),\n      letterSpacing: computedStyle.getPropertyValue(\"letter-spacing\"),\n      whiteSpace: computedStyle.getPropertyValue(\"white-space\"),\n      padding: computedStyle.getPropertyValue(\"padding\"),\n      border: computedStyle.getPropertyValue(\"border\"),\n      wordWrap: computedStyle.getPropertyValue(\"word-wrap\"),\n      verticalAlign: computedStyle.getPropertyValue(\"vertical-align\"),\n      textIndent: computedStyle.getPropertyValue(\"text-indent\")\n    };\n    setStyle(filteredStyles);\n  }, [textareaRef]);\n  useEffect(() => {\n    if (textareaRef.current) {\n      copyStyle();\n      const resizeObserver = new ResizeObserver(\n        (entries) => copySize(entries[0])\n      );\n      resizeObserver.observe(textareaRef.current);\n      return () => {\n        resizeObserver.disconnect();\n      };\n    }\n  }, [textareaRef, copySize, copyStyle]);\n  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(\n    \"span\",\n    {\n      ref: highlightAreaRef,\n      style: {\n        ...props.style,\n        ...style,\n        backgroundColor: props.style?.backgroundColor || \"#fff\",\n        background: props.style?.background\n      },\n      className: S.highlightArea,\n      \"aria-hidden\": true\n    },\n    valueWithHighlights\n  ), /* @__PURE__ */ React.createElement(\n    \"textarea\",\n    {\n      ref: textareaRef,\n      onChange: handleChange,\n      onScroll: handleScroll,\n      ...props,\n      style: {\n        ...props.style,\n        background: \"transparent\",\n        position: \"relative\",\n        zIndex: 1\n      }\n    }\n  ));\n});\nTextareaWithHighlights.displayName = \"TextareaWithHighlights\";\n\nexport { TextareaWithHighlights };\n"],"names":["useForwardedRef","forwardedRef","initialValue","innerRef","useRef","useEffect","useValueWithHighlights","value","highlights","useMemo","ranges","regexes","strings","acc","cur","stringsAsRanges","string","i","regexesAsRanges","regex","matches","prevIndex","match","allRanges","sortedRanges","a","b","mergedRanges","start","end","prev","from","to","index","React","elementStyle","e","highlightArea","S","TextareaWithHighlights","forwardRef","onChange","onScroll","props","ref","setValue","useState","style","setStyle","highlightAreaRef","textareaRef","valueWithHighlights","handleChange","useCallback","event","handleScroll","target","copySize","entry","width","height","copyStyle","computedStyle","filteredStyles","resizeObserver","entries","_a","_b"],"mappings":"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"}